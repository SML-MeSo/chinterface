# Chinterface (Chat Interface)

A unified interface for Chats around the world.

## Services Supported

- Twitch (Read/Write)
- Mixer (Read/Write)

## Planned Services

- YouTube
- Facebook Live
- Dailymotion

## Notes

It is recommend to apply the following styles to emotes across all services.

```css
.emoticon {
    vertical-align: middle;
    display: inline-block;
}
```

## Twitch

### Setup and Usage

```js
// Twitch.

import chinterface from 'chinterface';

async function twitch() {
    const twitch = chinterface.service('twitch');
    
    try {
        // Set the default config values.
        await twitch.setConfig({
            // Main configuration
            clientId: 'as545trdsFdgghNXoyit83nguf11gpOx', // REQUIRED. Your Twitch Application Client ID.
            channel: 'oyed', // REQUIRED. If you do not know the channel, pass through accessToken and make a request to loadUser().
            userId: 123456, // Optional; REQUIRED to fetch badges. If you do not know the user ID, pass through accessToken and make a request to loadUser().
            
            // Settings
            reconnect: false, // Default: true [auto reconnect if connection is lost]
            parseEmoticon: false, // Default: true [convert emoticons to images]
            formatMessages: false, // Default: true [process message and convert emoticons; body will be null if false]
            
            // Optional; REQUIRED for sending/writing messages
            username: 'oyed', // The user's Twitch username. This is ONLY used to authenticate to send messages.
            accessToken: 'as545trdsFdgghNXoyit83nguf11gpOx', // The user's Twitch API access token. This is ONLY used to authenticate to send messages.
        });
        
        // If you do not know the username, channel or userId, make a request to loadUser(). It will set these values for you.
        await twitch.loadUser();
        
        // Connect to the socket server.
        await twitch.connect();
        
        // To receive and listen for new, formatted messages.
        twitch.on('message', data => {
            /**
             * `data` will always return the following structure:
             *
             * {string} id - The chat message ID; generated by Twitch.
             * {string} username
             * {string} body - The processed message, with <img> tags for emotes.
             * {string} raw - The unprocessed message, direct from the service.
             * {number} timestamp - The time in milliseconds.
             * {Object} extra - Service-specific information.
             */
            console.log('New message', data);
        });
        
        // To send a message.
        twitch.send('test message');
        
        // Disconnect from the socket server.
        await twitch.disconnect();
    } catch (e) {
        console.log(e);
    }
}
```

Chinterface provides a set of unique events and functions that assist in the display and handling of messages for Twitch.

### Fetch and Set Twitch User Information
In cases where you do not know the `userId`, `channel` or `username`, you can use the `loadUser()` function to set the config for you.

Requires `clientId` and `accessToken`. This function will NOT overwrite any previously set properties.

```
await twitch.loadUser();
```

### Accessing TMI Events
Chinterface provides a clean wrapper to directly access TMI Events. This is useful when you want to listen to clearchat, timeouts or bans.

See here for a list of events: https://docs.tmijs.org/v1.2.1/Events.html

```
twitch.clientOn('timeout', (channel, username, reason, duration) => {
    // Remove all messages for the given channel and username
});

twitch.clientOn('ban', (channel, username, reason) => {
    // Remove all messages for the given channel and username
]);

twitch.clientOn('clearchat', channel => {
    // Remove all messages for the given channel
});
```

### Badges
It's common to output a user's associated badges when displaying Twitch messages. You may use the `getBadges()` function to return a list of badges and respective URLs for the connected channel.

Requires `clientId` and `userId`. If you do not know the user ID, make a request to `loadUser()` first.

```
// Get all badges for all connected Twitch channels
const badges = await twitch.getBadges();
```

## Mixer

### Setup and Usage
```js
// Mixer

import chinterface from 'chinterface';

async function mixer() {
    const mixer = chinterface.service('mixer');
    
    try {
        // Mixer chat requires you to pass through a WebSocket instance.
        // If using the browser, pass through WebSocket.
        // If using Node JS, try 'ws' or 'uws'.        
        await mixer.setWebSocket(WebSocket);
    
        // Set the default config values.
        await mixer.setConfig({
            // Main configuration
            channelId: 654321, // REQUIRED. If unknown, set username and make a request to loadUser() before connecting.
            username: 'oyed', // Optional; ONLY REQUIRED if using loadUser().
            
            // Settings
            reconnect: false, // Default: true [auto reconnect if connection is lost]
            parseEmoticon: false, // Default: true [convert emoticons to images]
            parseUrl: false, // Default: true [convert URLs to anchor tags]
            formatMessages: false, // Default: true [process message and convert emoticons; body will be null if false]
            
            // Optional; REQUIRED for sending/writing messages.
            userId: 123456, // The user's Mixer user ID. This is ONLY used to authenticate to send messages.
            accessToken: '', // The user's Mixer API access token. This is ONLY used to authenticate to send messages.
        });
        
        // If you only know the user's username, make a request to loadUser(). It will set the userId and channelId for you.
        // If you already know the user's channelId AND/OR userId, this function is NOT required.
        await mixer.loadUser();
        
        // Connect to the socket server.
        await mixer.connect();
        
        // To receive and listen for new, formatted messages.
        mixer.on('message', data => {
            /**
             * `data` will always return the following structure:
             *
             * {string} id - The chat message ID; generated by Mixer.
             * {string} username
             * {string} body - The processed message, with <span> tags for emotes.
             * {string} raw - The unprocessed message, direct from the service.
             * {number} timestamp - The time in milliseconds.
             * {Object} extra - Service-specific information.
             */
            console.log('New message', data);
        });
        
        // To send a message.
        mixer.send('test message');
        
        // Disconnect from the socket server.
        await mixer.disconnect();
    } catch (e) {
        console.log(e);
    }
}
```

Chinterface provides a set of unique events and functions that assist in the display and handling of messages for Mixer.

### Fetch and Set Mixer User Information
In cases where you do not know the `channelId` or `userId`, you can use the `loadUser()` function to set the config for you.

Requires `username`. This function will NOT overwrite any previously set properties.

```
await mixer.loadUser();
```

### Interface Events

Chinterface exposes several events for connecting, disconnecting and erroring.

```js
// Reconnecting
mixer.on('reconnect', attempt => {
    console.log('Reconnecting ') 
});

```

### User Events

Mixer's chat emits a number of different events for actions including user joining, message deletion, user ban, chat clearing and many more.

Check here for a full list of events: https://dev.mixer.com/reference/chat/index.html#chat__events // NOTE: not all are supported

```js
// User join
mixer.on('user-join', data => {
    /**
     * `data` will always return the following structure:
     *
     * {number} id - The user's user ID
     * {string} username - The user's name
     * {array} roles - The roles available to this user
     */
    console.log('User join: ', data);
});

// User leave
mixer.on('user-leave', data => {
    /**
     * `data` will always return the following structure:
     *
     * {number} id - The user's user ID
     * {string} username - The user's name
     */
    console.log('User leave: ', data);
});

// Message deleted
mixer.on('delete-message', id => {
    console.log('Deleted message ID: ', id);
});

// User messages purged
mixer.on('purge-message', userId => {
    console.log('Deleted messages for user ID: ', userId);
});

// All messages are cleared.
mixer.on('clear-messages', () => {
    // clear chat
});

mixer.on('user-timeout', data => {
    /**
     * `data` will always return the following structure:
     *
     * {Object} user
     * *** {number} id - The user's user ID
     * *** {string} username - The user's name
     * {number} duration - Number of seconds (? - unsure; not documented) a user is banned for.
     */
    console.log('User timeout: ', data);
})
```